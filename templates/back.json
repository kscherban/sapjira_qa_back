{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "dbUsername": {
            "type": "string",
            "metadata": {
                "description": "Database username"
            }
        },
        "dbPassword": {
            "type": "string",
            "metadata": {
                "description": "Database password"
            }
        }
    },
    "variables": {
        "namespace": "jira",
        "sql": {
            "server": {
                "name": "[concat(variables('namespace'), 'sqlserver', uniqueString(resourceGroup().id))]",
                "username": "[parameters('dbUsername')]",
                "password": "[parameters('dbPassword')]"
            },
            "database": {
                "name": "[concat('jira', 'sqldatabase')]",
                "edition": "Premium",
                "collation": "SQL_Latin1_General_CP437_CI_AI",
                "maxSizeBytes": "107374182400",
                "schema": "jiraschema"
            }
        }
    },
    "resources": [
        {
            "type": "Microsoft.Sql/servers/databases",
            "name": "database",
            "apiVersion": "2014-04-01",
            "location": "[resourceGroup().location]",
            "properties": {
                "edition": "[variables('sql').database.edition]",
                "collation": "[variables('sql').database.collation]",
                "maxSizeBytes": "[variables('sql').database.maxSizeBytes]",
                "requestedServiceObjectiveName": "Basic"
            },
            "dependsOn": [
                "[concat(variables('sql').server.name, uniqueString(resourceGroup().id))]"
                // "[resourceId('Microsoft.Sql/servers/', variables('sql').server.name)]"
            ]
        },
  {
    "name": "[concat(variables('sql').server.name, uniqueString(resourceGroup().id))]",
    "type": "Microsoft.Sql/servers",
    "apiVersion": "2015-05-01-preview",
    "location": "[resourceGroup().location]",
    "identity": {
      "type": "SystemAssigned"
    },
    "properties": {
      "administratorLogin": "[variables('sql').server.username]",
      "administratorLoginPassword": "[variables('sql').server.password]",
      "version": "12.0"
    }
  }  
   ],
    "outputs": {  }
  }